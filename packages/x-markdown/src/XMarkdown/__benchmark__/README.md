# Markdown 渲染器性能基准测试

本基准测试用于比较不同 Markdown 渲染器在流式渲染场景下的性能表现。

## 支持的渲染器

- **marked** - 流行的 Markdown 解析器
- **markdown-it** - 可配置的 Markdown 解析器
- **react-markdown** - React组件形式的 Markdown 渲染器
- **x-markdown** - 本项目的高性能 Markdown 渲染器
- **streamdown** - 流式 Markdown 渲染器

## 使用方法

### 一键运行完整基准测试

````bash
# 在项目根目录下运行
cd packages/x-markdown/benchmark

# 一键运行完整基准测试（推荐）
npm run benchmark


## 生成的报告

运行完成后，会在 `test-results/` 目录下生成以下报告：

### 主要报告

- `benchmark-report.html` - 标准性能报告
- `benchmark-results.json` - 原始JSON数据

### 增强版报告（新增）

- `benchmark-comparison.html` - 详细对比报告，包含所有渲染器的完整对比
- `benchmark-historical.html` - 历史趋势报告，支持多次运行的数据对比
- `benchmark-history.json` - 历史数据存储

## 报告内容

### 标准报告包含

- 各渲染器的渲染时长
- 平均FPS和帧率稳定性
- 内存使用峰值和增量
- 系统信息
- 交互式图表对比

### 增强版报告包含

- **性能排名** - 自动计算最快渲染器、最省内存渲染器等
- **历史趋势** - 多次运行的性能变化趋势
- **综合评分** - 基于多维度指标的综合性能评分
- **详细对比表** - 所有指标的完整对比表格

## 示例输出

运行后会看到类似以下的输出：

```
🚀 开始运行完整的 Markdown 渲染器性能基准测试...

📦 检查并安装依赖...
🌐 安装Playwright浏览器...
🧹 清理旧的测试结果...
🏃 运行所有渲染器的性能测试...

📊 Benchmark Results Table
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
┌─────────┬────────────────┬──────────────┬──────────┬─────────────┬──────────────┬──────────────┬─────────────┐
│ (index) │    Renderer    │ Duration(ms) │ Avg FPS  │ StdDev FPS  │ Avg Memory…  │ Memory Del…  │ Total Frames│
├─────────┼────────────────┼──────────────┼──────────┼─────────────┼──────────────┼──────────────┼─────────────┤
│    0    │    'marked'    │     5234     │  '45.2'  │   '12.34'   │    '25.43'   │    '2.15'    │    234      │
│    1    │ 'markdown-it'  │     6123     │  '38.7'  │   '15.21'   │    '28.91'   │    '3.42'    │    198      │
│    2    │ 'react-markdown'│     7891    │  '32.1'  │   '18.45'   │    '35.67'   │    '5.23'    │    167      │
│    3    │   'x-markdown' │     4456     │  '52.8'  │   '8.92'    │    '22.34'   │    '1.89'    │    267      │
│    4    │   'streamdown' │     3987     │  '58.3'  │   '6.78'    │    '20.12'   │    '1.23'    │    289      │
└─────────┴────────────────┴──────────────┴──────────┴─────────────┴──────────────┴──────────────┴─────────────┘
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📊 HTML报告已生成: test-results/benchmark-report.html
📊 JSON报告已生成: test-results/benchmark-results.json
📊 增强版报告生成完成！
   📈 历史对比报告: test-results/benchmark-historical.html
   🔍 详细对比报告: test-results/benchmark-comparison.html
```

## 性能指标说明

- **渲染时长** - 完成整个文档渲染的总时间（毫秒）
- **平均FPS** - 渲染过程中的平均帧率
- **FPS标准差** - 帧率稳定性指标，越小越稳定
- **内存峰值** - 渲染过程中的最大内存使用量
- **内存增量** - 渲染过程中新增的内存使用量
- **总帧数** - 渲染过程中生成的总帧数

## 注意事项

1. **运行环境** - 建议在性能较好的机器上运行以获得准确结果
2. **浏览器缓存** - 每次运行前会自动清理浏览器缓存
3. **多次运行** - 默认运行3次取平均值以提高准确性
4. **系统资源** - 运行期间请关闭其他占用资源的程序

## 故障排除

如果遇到问题，请检查：

1. **依赖安装** - 确保所有依赖已正确安装
2. **浏览器支持** - 确保已安装Chromium浏览器
3. **内存限制** - 确保系统有足够的可用内存
4. **网络连接** - 首次运行需要下载浏览器组件

## 自定义测试

可以通过修改 `performance.spec.tsx` 文件来自定义测试：

- 调整 `RUN_COUNT` 改变运行次数
- 修改 `renderers` 数组添加或移除渲染器
- 调整 `updateInterval` 改变流式更新频率
- 更换测试文档 `test.md`
````
